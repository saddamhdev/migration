Below is a **complete, runnable Spring Boot + Flyway** project (Banking-style) with:

* **Flyway migrations** (create tables + seed data)
* **JPA entities** (but *no* Hibernate auto-ddl)
* **REST API**: create account, deposit, withdraw, get account summary
* **Validation + clean error responses**

---

## 1) Project structure

```
flyway-banking/
 ├─ pom.xml
 └─ src/
    ├─ main/
    │  ├─ java/com/example/banking/
    │  │  ├─ BankingApplication.java
    │  │  ├─ api/AccountController.java
    │  │  ├─ api/dto/
    │  │  │  ├─ CreateAccountRequest.java
    │  │  │  ├─ MoneyRequest.java
    │  │  │  └─ AccountSummaryResponse.java
    │  │  ├─ domain/
    │  │  │  ├─ Account.java
    │  │  │  ├─ Txn.java
    │  │  │  └─ TxnType.java
    │  │  ├─ repo/
    │  │  │  ├─ AccountRepository.java
    │  │  │  └─ TxnRepository.java
    │  │  ├─ service/AccountService.java
    │  │  └─ web/GlobalExceptionHandler.java
    │  └─ resources/
    │     ├─ application.yml
    │     └─ db/migration/
    │        ├─ V1__init_schema.sql
    │        └─ V2__seed_data.sql
    └─ test/java/com/example/banking/SmokeTest.java
```

---

## 2) `pom.xml`

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-parent</artifactId>
    <version>3.3.5</version>
    <relativePath/>
  </parent>

  <groupId>com.example</groupId>
  <artifactId>flyway-banking</artifactId>
  <version>1.0.0</version>
  <name>flyway-banking</name>

  <properties>
    <java.version>17</java.version>
  </properties>

  <dependencies>
    <!-- REST -->
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- Validation -->
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-validation</artifactId>
    </dependency>

    <!-- JPA (we will NOT auto-create schema; Flyway will) -->
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>

    <!-- Flyway -->
    <dependency>
      <groupId>org.flywaydb</groupId>
      <artifactId>flyway-core</artifactId>
    </dependency>

    <!-- H2 for easy local run -->
    <dependency>
      <groupId>com.h2database</groupId>
      <artifactId>h2</artifactId>
      <scope>runtime</scope>
    </dependency>

    <!-- Tests -->
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-test</artifactId>
      <scope>test</scope>
    </dependency>
  </dependencies>

  <build>
    <plugins>
      <plugin>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-maven-plugin</artifactId>
      </plugin>
    </plugins>
  </build>
</project>
```

---

## 3) `application.yml` (IMPORTANT: disable auto-ddl)

```yml
server:
  port: 8080

spring:
  datasource:
    url: jdbc:h2:mem:bankdb;MODE=PostgreSQL;DB_CLOSE_DELAY=-1;DATABASE_TO_UPPER=false
    driverClassName: org.h2.Driver
    username: sa
    password:

  jpa:
    hibernate:
      ddl-auto: none   # ✅ Flyway owns schema
    properties:
      hibernate:
        format_sql: true

  flyway:
    enabled: true
    locations: classpath:db/migration

  h2:
    console:
      enabled: true
      path: /h2-console
```

---

## 4) Flyway migrations

### `db/migration/V1__init_schema.sql`

```sql
CREATE TABLE accounts (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  account_no VARCHAR(32) NOT NULL UNIQUE,
  owner_name VARCHAR(120) NOT NULL,
  balance DECIMAL(19,2) NOT NULL DEFAULT 0.00,
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE txns (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  account_id BIGINT NOT NULL,
  type VARCHAR(20) NOT NULL,
  amount DECIMAL(19,2) NOT NULL,
  note VARCHAR(255),
  created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_txn_account FOREIGN KEY (account_id) REFERENCES accounts(id)
);

CREATE INDEX idx_txns_account_id ON txns(account_id);
CREATE INDEX idx_txns_created_at ON txns(created_at);
```

### `db/migration/V2__seed_data.sql`

```sql
INSERT INTO accounts (account_no, owner_name, balance)
VALUES
  ('ACC-1001', 'Demo User', 5000.00);

INSERT INTO txns (account_id, type, amount, note)
SELECT id, 'DEPOSIT', 5000.00, 'Initial seed'
FROM accounts
WHERE account_no = 'ACC-1001';
```

---

## 5) Spring Boot code

### `BankingApplication.java`

```java
package com.example.banking;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class BankingApplication {
  public static void main(String[] args) {
    SpringApplication.run(BankingApplication.class, args);
  }
}
```

---

### Domain

#### `domain/TxnType.java`

```java
package com.example.banking.domain;

public enum TxnType {
  DEPOSIT, WITHDRAW
}
```

#### `domain/Account.java`

```java
package com.example.banking.domain;

import jakarta.persistence.*;
import java.math.BigDecimal;
import java.time.Instant;

@Entity
@Table(name = "accounts")
public class Account {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  @Column(name = "account_no", nullable = false, unique = true, length = 32)
  private String accountNo;

  @Column(name = "owner_name", nullable = false, length = 120)
  private String ownerName;

  @Column(nullable = false, precision = 19, scale = 2)
  private BigDecimal balance = BigDecimal.ZERO;

  @Column(name = "created_at", nullable = false, updatable = false)
  private Instant createdAt;

  @PrePersist
  void prePersist() {
    if (createdAt == null) createdAt = Instant.now();
    if (balance == null) balance = BigDecimal.ZERO;
  }

  // getters/setters
  public Long getId() { return id; }
  public String getAccountNo() { return accountNo; }
  public void setAccountNo(String accountNo) { this.accountNo = accountNo; }
  public String getOwnerName() { return ownerName; }
  public void setOwnerName(String ownerName) { this.ownerName = ownerName; }
  public BigDecimal getBalance() { return balance; }
  public void setBalance(BigDecimal balance) { this.balance = balance; }
  public Instant getCreatedAt() { return createdAt; }
}
```

#### `domain/Txn.java`

```java
package com.example.banking.domain;

import jakarta.persistence.*;
import java.math.BigDecimal;
import java.time.Instant;

@Entity
@Table(name = "txns")
public class Txn {

  @Id
  @GeneratedValue(strategy = GenerationType.IDENTITY)
  private Long id;

  @ManyToOne(fetch = FetchType.LAZY, optional = false)
  @JoinColumn(name = "account_id", nullable = false)
  private Account account;

  @Enumerated(EnumType.STRING)
  @Column(nullable = false, length = 20)
  private TxnType type;

  @Column(nullable = false, precision = 19, scale = 2)
  private BigDecimal amount;

  @Column(length = 255)
  private String note;

  @Column(name = "created_at", nullable = false, updatable = false)
  private Instant createdAt;

  @PrePersist
  void prePersist() {
    if (createdAt == null) createdAt = Instant.now();
  }

  // getters/setters
  public Long getId() { return id; }
  public Account getAccount() { return account; }
  public void setAccount(Account account) { this.account = account; }
  public TxnType getType() { return type; }
  public void setType(TxnType type) { this.type = type; }
  public BigDecimal getAmount() { return amount; }
  public void setAmount(BigDecimal amount) { this.amount = amount; }
  public String getNote() { return note; }
  public void setNote(String note) { this.note = note; }
  public Instant getCreatedAt() { return createdAt; }
}
```

---

### Repositories

#### `repo/AccountRepository.java`

```java
package com.example.banking.repo;

import com.example.banking.domain.Account;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface AccountRepository extends JpaRepository<Account, Long> {
  Optional<Account> findByAccountNo(String accountNo);
  boolean existsByAccountNo(String accountNo);
}
```

#### `repo/TxnRepository.java`

```java
package com.example.banking.repo;

import com.example.banking.domain.Txn;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.List;

public interface TxnRepository extends JpaRepository<Txn, Long> {
  List<Txn> findTop20ByAccount_AccountNoOrderByCreatedAtDesc(String accountNo);
}
```

---

### DTOs

#### `api/dto/CreateAccountRequest.java`

```java
package com.example.banking.api.dto;

import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.Size;

public record CreateAccountRequest(
    @NotBlank @Size(min = 4, max = 32) String accountNo,
    @NotBlank @Size(min = 2, max = 120) String ownerName
) {}
```

#### `api/dto/MoneyRequest.java`

```java
package com.example.banking.api.dto;

import jakarta.validation.constraints.DecimalMin;
import jakarta.validation.constraints.NotNull;

import java.math.BigDecimal;

public record MoneyRequest(
    @NotNull @DecimalMin(value = "0.01") BigDecimal amount,
    String note
) {}
```

#### `api/dto/AccountSummaryResponse.java`

```java
package com.example.banking.api.dto;

import java.math.BigDecimal;
import java.time.Instant;
import java.util.List;

public record AccountSummaryResponse(
    String accountNo,
    String ownerName,
    BigDecimal balance,
    Instant createdAt,
    List<TxnItem> lastTxns
) {
  public record TxnItem(String type, BigDecimal amount, String note, Instant createdAt) {}
}
```

---

### Service

#### `service/AccountService.java`

```java
package com.example.banking.service;

import com.example.banking.api.dto.AccountSummaryResponse;
import com.example.banking.domain.Account;
import com.example.banking.domain.Txn;
import com.example.banking.domain.TxnType;
import com.example.banking.repo.AccountRepository;
import com.example.banking.repo.TxnRepository;
import jakarta.transaction.Transactional;
import org.springframework.stereotype.Service;

import java.math.BigDecimal;
import java.util.List;

@Service
public class AccountService {

  private final AccountRepository accountRepo;
  private final TxnRepository txnRepo;

  public AccountService(AccountRepository accountRepo, TxnRepository txnRepo) {
    this.accountRepo = accountRepo;
    this.txnRepo = txnRepo;
  }

  @Transactional
  public Account createAccount(String accountNo, String ownerName) {
    if (accountRepo.existsByAccountNo(accountNo)) {
      throw new IllegalArgumentException("Account already exists: " + accountNo);
    }
    Account a = new Account();
    a.setAccountNo(accountNo);
    a.setOwnerName(ownerName);
    a.setBalance(BigDecimal.ZERO);
    return accountRepo.save(a);
  }

  @Transactional
  public Account deposit(String accountNo, BigDecimal amount, String note) {
    Account a = accountRepo.findByAccountNo(accountNo)
        .orElseThrow(() -> new IllegalArgumentException("Account not found: " + accountNo));

    a.setBalance(a.getBalance().add(amount));

    Txn t = new Txn();
    t.setAccount(a);
    t.setType(TxnType.DEPOSIT);
    t.setAmount(amount);
    t.setNote(note);
    txnRepo.save(t);

    return a;
  }

  @Transactional
  public Account withdraw(String accountNo, BigDecimal amount, String note) {
    Account a = accountRepo.findByAccountNo(accountNo)
        .orElseThrow(() -> new IllegalArgumentException("Account not found: " + accountNo));

    if (a.getBalance().compareTo(amount) < 0) {
      throw new IllegalStateException("Insufficient balance. Current balance: " + a.getBalance());
    }

    a.setBalance(a.getBalance().subtract(amount));

    Txn t = new Txn();
    t.setAccount(a);
    t.setType(TxnType.WITHDRAW);
    t.setAmount(amount);
    t.setNote(note);
    txnRepo.save(t);

    return a;
  }

  @Transactional
  public AccountSummaryResponse summary(String accountNo) {
    Account a = accountRepo.findByAccountNo(accountNo)
        .orElseThrow(() -> new IllegalArgumentException("Account not found: " + accountNo));

    List<AccountSummaryResponse.TxnItem> items = txnRepo
        .findTop20ByAccount_AccountNoOrderByCreatedAtDesc(accountNo)
        .stream()
        .map(tx -> new AccountSummaryResponse.TxnItem(
            tx.getType().name(),
            tx.getAmount(),
            tx.getNote(),
            tx.getCreatedAt()
        ))
        .toList();

    return new AccountSummaryResponse(
        a.getAccountNo(),
        a.getOwnerName(),
        a.getBalance(),
        a.getCreatedAt(),
        items
    );
  }
}
```

---

### Controller

#### `api/AccountController.java`

```java
package com.example.banking.api;

import com.example.banking.api.dto.AccountSummaryResponse;
import com.example.banking.api.dto.CreateAccountRequest;
import com.example.banking.api.dto.MoneyRequest;
import com.example.banking.domain.Account;
import com.example.banking.service.AccountService;
import jakarta.validation.Valid;
import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/accounts")
public class AccountController {

  private final AccountService service;

  public AccountController(AccountService service) {
    this.service = service;
  }

  @PostMapping
  @ResponseStatus(HttpStatus.CREATED)
  public Account create(@Valid @RequestBody CreateAccountRequest req) {
    return service.createAccount(req.accountNo().trim(), req.ownerName().trim());
  }

  @PostMapping("/{accountNo}/deposit")
  public Account deposit(@PathVariable String accountNo, @Valid @RequestBody MoneyRequest req) {
    return service.deposit(accountNo.trim(), req.amount(), req.note());
  }

  @PostMapping("/{accountNo}/withdraw")
  public Account withdraw(@PathVariable String accountNo, @Valid @RequestBody MoneyRequest req) {
    return service.withdraw(accountNo.trim(), req.amount(), req.note());
  }

  @GetMapping("/{accountNo}/summary")
  public AccountSummaryResponse summary(@PathVariable String accountNo) {
    return service.summary(accountNo.trim());
  }
}
```

---

### Global error handling (clean JSON errors)

#### `web/GlobalExceptionHandler.java`

```java
package com.example.banking.web;

import org.springframework.http.HttpStatus;
import org.springframework.http.ProblemDetail;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

@RestControllerAdvice
public class GlobalExceptionHandler {

  @ExceptionHandler(MethodArgumentNotValidException.class)
  @ResponseStatus(HttpStatus.BAD_REQUEST)
  public ProblemDetail handleValidation(MethodArgumentNotValidException ex) {
    ProblemDetail pd = ProblemDetail.forStatus(HttpStatus.BAD_REQUEST);
    pd.setTitle("Validation error");

    Map<String, String> errors = new HashMap<>();
    ex.getBindingResult().getFieldErrors()
        .forEach(fe -> errors.put(fe.getField(), fe.getDefaultMessage()));

    pd.setProperty("errors", errors);
    return pd;
  }

  @ExceptionHandler(IllegalArgumentException.class)
  @ResponseStatus(HttpStatus.NOT_FOUND)
  public ProblemDetail handleNotFound(IllegalArgumentException ex) {
    ProblemDetail pd = ProblemDetail.forStatus(HttpStatus.NOT_FOUND);
    pd.setTitle("Not found");
    pd.setDetail(ex.getMessage());
    return pd;
  }

  @ExceptionHandler(IllegalStateException.class)
  @ResponseStatus(HttpStatus.BAD_REQUEST)
  public ProblemDetail handleBadRequest(IllegalStateException ex) {
    ProblemDetail pd = ProblemDetail.forStatus(HttpStatus.BAD_REQUEST);
    pd.setTitle("Bad request");
    pd.setDetail(ex.getMessage());
    return pd;
  }
}
```

---

## 6) Test (smoke)

#### `test/SmokeTest.java`

```java
package com.example.banking;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class SmokeTest {
  @Test void contextLoads() {}
}
```

---

## 7) Run it

```bash
mvn clean test
mvn spring-boot:run
```

H2 console: `http://localhost:8080/h2-console`
JDBC URL: `jdbc:h2:mem:bankdb`

---

## 8) Try API (copy/paste)

### Seeded account summary

```bash
curl http://localhost:8080/api/accounts/ACC-1001/summary
```

### Create new account

```bash
curl -X POST http://localhost:8080/api/accounts \
  -H "Content-Type: application/json" \
  -d '{"accountNo":"ACC-2001","ownerName":"Saddam"}'
```

### Deposit

```bash
curl -X POST http://localhost:8080/api/accounts/ACC-2001/deposit \
  -H "Content-Type: application/json" \
  -d '{"amount":1500.50,"note":"Salary"}'
```

### Withdraw

```bash
curl -X POST http://localhost:8080/api/accounts/ACC-2001/withdraw \
  -H "Content-Type: application/json" \
  -d '{"amount":200.00,"note":"ATM"}'
```

---

If you want, I can extend this project with:

* **PostgreSQL profile + Docker Compose**
* **Flyway baseline/repair + prod migration workflow**
* **Optimistic locking + audit fields**
* **Swagger/OpenAPI docs**
